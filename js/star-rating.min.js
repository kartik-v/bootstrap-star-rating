/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2013
 * @version 1.0.0
 *
 * A simple yet powerful JQuery star rating plugin for Bootstrap.
 * 
 * Built originally for Yii Framework 2.0. But is usable across frameworks & scenarios.
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */
(function(e){var t=1;var n=5;var r=1;var i=function(t,n){return t===null||t===undefined||t==[]||t===""||n&&e.trim(t)===""};var s=function(e,t,n){var r=i(e.data(t))?e.attr(t):e.data(t);if(r){return r}return n[t]};var o=function(t,n){this.$element=e(t);this.min=this._parseAttr("min",n);this.max=this._parseAttr("max",n);this.step=this._parseAttr("step",n);this.disabled=s(this.$element,"disabled",n);this.readonly=s(this.$element,"readonly",n);this.rtl=n.rtl;this.showClear=n.showClear;this.showCaption=n.showCaption;this.size=n.size;this.defaultCaption=n.defaultCaption;this.starCaptions=n.starCaptions;this.starCaptionClasses=n.starCaptionClasses;this.clearButton=n.clearButton;this.clearButtonTitle=n.clearButtonTitle;this.clearCaption=n.clearCaption;this.clearCaptionClass=n.clearCaptionClass;this.clearValue=n.clearValue;this.inactive=this.disabled||this.readonly;this.inputValue=this.$element.val();this.$clearElement=n.clearElement;this.$captionElement=n.captionElement;this.$container=this.createContainer();this.$star=this.$container.children("s");this.$stars=this.$container.find("s");this.$clear=!i(this.$clearElement)?this.$clearElement:this.$container.find(".clear-rating");this.$caption=!i(this.$captionElement)?this.$captionElement:this.$container.find(".caption");this._init();this.initialValue=parseFloat(this.$element.val())};o.prototype={constructor:o,_parseAttr:function(e,o){var u=this,a=u.$element;if(a.attr("type")==="number"){var f=s(a,e,o);var l=r;if(e==="min"){l=t}else if(e==="max"){l=n}else if(e==="step"){l=r}var c=i(f)?l:f;return parseFloat(c)}return parseFloat(o[e])},_init:function(){var t=this;t.$element.before(t.$container);t.$element.hide();t.$star.on("click",function(e){if(!t.inactive){t.change(e)}});t.$clear.on("click",e.proxy(t.clear,t));e(t.$element[0].form).on("reset",e.proxy(t.reset,t))},createContainer:function(){var t=this;var n=t.rtl?"star-rating-rtl":"star-rating";n+=t.inactive?t.disabled?" "+n+"-disabled ":" ":" "+n+"-active ";n+="rating-"+t.size;var r=t.renderRating();var i=e(document.createElement("div")).attr({"class":n}).html(r);return i},renderRating:function(){var e=this;var t=e.renderStars();var n=e.renderClear();var r=e.renderCaption();return e.rtl?r+t+n:n+t+r},renderStars:function(){var e="",t="";var n=this;var s=n.step>0?n.step:r;var o=parseInt(n.max/s);for(var u=n.min;u<=n.max;u+=s){e+=!i(n.inputValue)&&u<=n.inputValue?'<s class="rated">':"<s>";t+="</s>"}return e+t},renderClear:function(){var e=this;if(!e.showClear){return""}var t=e.inactive?"clear-rating":"clear-rating clear-rating-active";if(!i(e.$clearElement)){e.$clearElement.removeClass(t).addClass(t).attr({title:e.clearButtonTitle});e.$clearElement.html(e.clearButton);return""}return'<div class="'+t+'" title="'+e.clearButtonTitle+'">'+e.clearButton+"</div>"},renderCaption:function(){var e=this,t=e.inputValue;if(!e.showCaption){return""}var n=e.fetchCaption(t);if(!i(e.$captionElement)){e.$captionElement.removeClass("caption").addClass("caption").attr({title:e.clearButtonTitle});e.$captionElement.html(n);return""}return'<div class="caption">'+n+"</div>"},fetchCaption:function(e){var t=this;var n=parseFloat(e);var r=i(t.starCaptionClasses[n])?t.clearCaptionClass:t.starCaptionClasses[n];var s=i(t.starCaptions[n])?t.clearCaption:t.starCaptions[n];return'<span class="'+r+'">'+s+"</span>"},change:function(t){var n=this;var r=e(t.target).parentsUntil("div").length+1;r=(r-1)*n.step+n.min;var s=!i(n.starCaptions[r]);var o=s?n.starCaptionClasses[r]:n.clearCaptionClass;var u=s?n.starCaptions[r]:n.defaultCaption.replace(/\{rating\}/g,r);var a='<span class="'+o+'">'+u+"</span>";n.$element.val(r);n.$caption.html(a);n.$stars.removeClass("rated");e(t.target).removeClass("rated").addClass("rated");e(t.target).parentsUntil("div","s").removeClass("rated").addClass("rated");n.$element.trigger("rating.change",[r,a])},clear:function(){var e=this;var t='<span class="'+e.clearCaptionClass+'">'+e.clearCaption+"</span>";e.$stars.removeClass("rated");e.$caption.html(t);e.$element.val(e.clearValue);e.$element.trigger("rating.clear")},refresh:function(){var e=this;e.initialValue=e.$element.val();e.reset()},reset:function(){var e=this,t=e.$container,n=e.initialValue,r=e.$caption;var i="";e.clear();if(n){var s=parseInt(n/e.step);t.find("s").addClass("rated");for(var o=1;o<=s;o++){i+=o===1?"s":" > s"}t.find(i+" > s").removeClass("rated");if(r){r.html(e.fetchCaption(n))}}e.$element.trigger("rating.reset")}};e.fn.rating=function(t){var n=Array.apply(null,arguments);n.shift();return this.each(function(){var r=e(this),i=r.data("rating"),s=typeof t==="object"&&t;if(!i){r.data("rating",i=new o(this,e.extend({},e.fn.rating.defaults,s,e(this).data())))}if(typeof t==="string"){i[t].apply(i,n)}})};e.fn.rating.defaults={min:t,max:n,step:r,disabled:false,readonly:false,rtl:false,size:"md",showClear:true,showCaption:true,defaultCaption:"{rating} Stars",starCaptions:{1:"One Star",2:"Two Stars",3:"Three Stars",4:"Four Stars",5:"Five Stars"},starCaptionClasses:{1:"label label-danger",2:"label label-warning",3:"label label-info",4:"label label-primary",5:"label label-success"},clearButton:'<i class="glyphicon glyphicon-minus-sign"></i>',clearButtonTitle:"Clear",clearCaption:"Not Rated",clearCaptionClass:"label label-default",clearValue:0,captionElement:null,clearElement:null};e(function(){var t=e("input.rating[type=number]");if(t.length>0){t.rating()}})})(jQuery)