/*!
 * @copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @version 2.0.0
 *
 * A simple yet powerful JQuery star rating plugin that allows rendering
 * fractional star ratings and supports Right to Left (RTL) input.
 * 
 * For more JQuery plugins visit http://plugins.krajee.com
 * For more Yii related demos visit http://demos.krajee.com
 */!function(t){var e=0,a=5,n=.5,i=function(){var t=document.createElement("input");return t.setAttribute("type","number"),"text"!==t.type},s=function(e,a){return"undefined"==typeof e||null===e||void 0===e||e==[]||""===e||a&&""===t.trim(e)},r=function(t,e,a){var n=s(t.data(e))?t.attr(e):t.data(e);return n?n:a[e]},l=function(e,a){this.$element=t(e),this.init(a)};l.prototype={constructor:l,_parseAttr:function(t,i){var l=this,o=l.$element;if("range"===o.attr("type")||"number"===o.attr("type")){var c=r(o,t,i),h=n;"min"===t?h=e:"max"===t?h=a:"step"===t&&(h=n);var p=s(c)?h:c;return parseFloat(p)}return parseFloat(i[t])},listen:function(){var e=this;e.$rating.on("click",function(t){e.inactive||(w=t.pageX-e.$rating.offset().left,e.setStars(w),e.$element.trigger("change"),e.$element.trigger("rating.change",[e.$element.val(),e.$caption.html()]))}),e.$clear.on("click",function(){e.inactive||e.clear()}),t(e.$element[0].form).on("reset",function(){e.inactive||e.reset()})},initSlider:function(t){var i=this;s(i.$element.val())&&i.$element.val(0),i.initialValue=i.$element.val(),i.min="undefined"!=typeof t.min?t.min:i._parseAttr("min",t),i.max="undefined"!=typeof t.max?t.max:i._parseAttr("max",t),i.step="undefined"!=typeof t.step?t.step:i._parseAttr("step",t),(isNaN(i.min)||s(i.min))&&(i.min=e),(isNaN(i.max)||s(i.max))&&(i.max=a),(isNaN(i.step)||s(i.step)||0==i.step)&&(i.step=n),i.diff=i.max-i.min},init:function(e){this.options=e,this.initSlider(e),this.checkDisabled(),$element=this.$element,this.containerClass=e.containerClass,this.glyphicon=e.glyphicon;var a=this.glyphicon?"":"★";this.symbol=s(e.symbol)?a:e.symbol,this.rtl=e.rtl||this.$element.attr("dir"),this.rtl&&this.$element.attr("dir","rtl"),this.showClear=e.showClear,this.showCaption=e.showCaption,this.size=e.size,this.stars=e.stars,this.defaultCaption=e.defaultCaption,this.starCaptions=e.starCaptions,this.starCaptionClasses=e.starCaptionClasses,this.clearButton=e.clearButton,this.clearButtonTitle=e.clearButtonTitle,this.clearButtonBaseClass=s(e.clearButtonBaseClass)?"clear-rating":e.clearButtonBaseClass,this.clearButtonActiveClass=s(e.clearButtonActiveClass)?"clear-rating-active":e.clearButtonActiveClass,this.clearCaption=e.clearCaption,this.clearCaptionClass=e.clearCaptionClass,this.clearValue=e.clearValue,this.$clearElement=e.clearElement,this.$captionElement=e.captionElement,this.$element.removeClass("form-control").addClass("form-control"),"undefined"==typeof this.$rating&&"undefined"==typeof this.$container&&(this.$rating=t(document.createElement("div")).html('<div class="rating-stars"></div>'),this.$container=t(document.createElement("div")),this.$container.before(this.$rating),this.$container.append(this.$rating),this.$element.before(this.$container).appendTo(this.$rating)),this.$stars=this.$rating.find(".rating-stars"),this.generateRating(),this.$clear=s(this.$clearElement)?this.$container.find("."+this.clearButtonBaseClass):this.$clearElement,this.$caption=s(this.$captionElement)?this.$container.find(".caption"):this.$captionElement,this.setStars(),this.$element.hide(),this.listen(),this.showClear&&this.$clear.attr({"class":this.getClearClass()})},checkDisabled:function(){var t=this;t.disabled=r(t.$element,"disabled",t.options),t.readonly=r(t.$element,"readonly",t.options),t.inactive=t.disabled||t.readonly},getClearClass:function(){return this.clearButtonBaseClass+" "+(this.inactive?"":this.clearButtonActiveClass)},generateRating:function(){var t=this,e=t.renderClear(),a=t.renderCaption(),n=t.rtl?"rating-container-rtl":"rating-container",i=t.getStars();n+=t.glyphicon?""==t.symbol?" rating-gly-star":" rating-gly":" rating-uni",t.$rating.attr("class",n),t.$rating.attr("data-content",i),t.$stars.attr("data-content",i);var n=t.rtl?"star-rating-rtl":"star-rating";t.$container.attr("class",n+" rating-"+t.size),t.inactive?t.$container.removeClass("rating-active").addClass("rating-disabled"):t.$container.removeClass("rating-disabled").addClass("rating-active"),"undefined"==typeof t.$caption&&"undefined"==typeof t.$clear&&(t.rtl?t.$container.prepend(a).append(e):t.$container.prepend(e).append(a)),s(t.containerClass)||t.$container.removeClass(t.containerClass).addClass(t.containerClass)},getStars:function(){for(var t=this,e=t.stars,a="",n=1;e>=n;n++)a+=t.symbol;return a},renderClear:function(){var t=this;if(!t.showClear)return"";var e=t.getClearClass();return s(t.$clearElement)?'<div class="'+e+'" title="'+t.clearButtonTitle+'">'+t.clearButton+"</div>":(t.$clearElement.removeClass(e).addClass(e).attr({title:t.clearButtonTitle}),t.$clearElement.html(t.clearButton),"")},renderCaption:function(){var t=this,e=t.$element.val();if(!t.showCaption)return"";var a=t.fetchCaption(e);return s(t.$captionElement)?'<div class="caption">'+a+"</div>":(t.$captionElement.removeClass("caption").addClass("caption").attr({title:t.clearCaption}),t.$captionElement.html(a),"")},fetchCaption:function(t){var e=this,a=parseFloat(t),n=s(e.starCaptionClasses[a])?e.clearCaptionClass:e.starCaptionClasses[a],i=s(e.starCaptions[a])?e.defaultCaption.replace(/\{rating\}/g,a):e.starCaptions[a],r=a==e.clearValue?e.clearCaption:i;return'<span class="'+n+'">'+r+"</span>"},getDecimalPlaces:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0},applyPrecision:function(t){var e=this,a=e.getDecimalPlaces(e.step),n=t.toFixed(a);return parseFloat(n)},getValueFromPosition:function(t){var e,a,n=this,i=n.$rating.width();return e=t/i,a=this.min+Math.round(n.diff*e/this.step)*this.step,a<this.min?a=this.min:a>this.max&&(a=this.max),a=this.applyPrecision(parseFloat(a)),n.rtl&&(a=n.max-a),a},setStars:function(t){var e=this,a=e.min,n=e.max,i=(e.step,arguments.length?e.getValueFromPosition(t):s(e.$element.val())?0:e.$element.val()),r=0,l=(e.$rating.width(),e.fetchCaption(i));r=(i-a)/n*100,e.rtl&&(r=100-r),e.$element.val(i),r+="%",e.$stars.css("width",r),e.$caption.html(l)},clear:function(){var t=this,e='<span class="'+t.clearCaptionClass+'">'+t.clearCaption+"</span>";t.$stars.removeClass("rated"),t.inactive||t.$caption.html(e),t.$element.val(t.clearValue),t.setStars(),t.$element.trigger("rating.clear")},reset:function(){var t=this;t.$element.val(t.initialValue),t.setStars(),t.$element.trigger("rating.reset")},update:function(t){if(arguments.length>0){var e=this;e.$element.val(t),e.setStars()}},refresh:function(e){var a=this;if(arguments.length){a.init(t.extend(a.options,e)),a.showClear?a.$clear.show():a.$clear.hide(),a.showCaption?a.$caption.show():a.$caption.hide()}}},t.fn.rating=function(e){var a=Array.apply(null,arguments);return a.shift(),this.each(function(){var n=t(this),i=n.data("rating"),s="object"==typeof e&&e;i||n.data("rating",i=new l(this,t.extend({},t.fn.rating.defaults,s,t(this).data()))),"string"==typeof e&&i[e].apply(i,a)})},t.fn.rating.defaults={stars:5,glyphicon:!0,symbol:null,disabled:!1,readonly:!1,rtl:!1,size:"md",showClear:!0,showCaption:!0,defaultCaption:"{rating} Stars",starCaptions:{.5:"Half Star",1:"One Star",1.5:"One & Half Star",2:"Two Stars",2.5:"Two & Half Stars",3:"Three Stars",3.5:"Three & Half Stars",4:"Four Stars",4.5:"Four & Half Stars",5:"Five Stars"},starCaptionClasses:{.5:"label label-danger",1:"label label-danger",1.5:"label label-warning",2:"label label-warning",2.5:"label label-info",3:"label label-info",3.5:"label label-primary",4:"label label-primary",4.5:"label label-success",5:"label label-success"},clearButton:'<i class="glyphicon glyphicon-minus-sign"></i>',clearButtonTitle:"Clear",clearButtonBaseClass:"clear-rating",clearButtonActiveClass:"clear-rating-active",clearCaption:"Not Rated",clearCaptionClass:"label label-default",clearValue:0,captionElement:null,clearElement:null,containerClass:null},t(function(){var e=t(i()?"input.rating[type=number]":"input.rating[type=text]");e.length>0&&e.rating()})}(jQuery);